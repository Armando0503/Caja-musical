#include "p16F628a.inc"    ;incluir librerias relacionadas con el dispositivo
 __CONFIG _FOSC_INTOSCCLK & _WDTE_OFF & _PWRTE_OFF & _MCLRE_OFF & _BOREN_OFF & _LVP_OFF & _CPD_OFF & _CP_OFF 
 ; TODO INSERT CONFIG CODE HERE USING CONFIG BITS GENERATOR

RES_VECT  CODE    0x0000            ; processor reset vector
    GOTO    START                   ;Salto a la primera instruccion
 
                      CBLOCK      0x20

		      PAUSE
                      TONO
		      timer2
		      timer3
		      timer4
		      timer5  
		      i
		      j
		      k
		      z
		    a
                      ENDC


INT_VECT CODE  0x004  ; interrupt vector
		    movf PAUSE,0; SE MUEVE PAUSE A W
		    XORLW D'1'; SE COMPARA W CON 1 EN CASO DE SEA 1 Z=1
		    BTFSc STATUS,Z; SE PREGUTA SI Z=1 DE SER ASI SALTA UNA LINEA
		    CLRF PAUSE; PONE PAUSE EN 0
		    BTFSc STATUS,Z;SE PREGUTA SI Z=1 DE SER ASI SALTA UNA LINEA
		    GOTO $+5
		    movf        TONO,W                  ;pasa nota almacenada en TONO a w
		    movwf       TMR0	;PARA LUEGO PASARLO A TMR0 QUE ES UN TEMPORIZADOR QUE CORTARA EL PROGRAMA EN EL TIEMPO FIJADO
		    MOVLW B'00000001'; ENCIENDE LED
		    XORWF PORTB, F;
		    bcf         INTCON,T0IF             ;bajo bandera de desbordamiento del TMR0 
		    bcf STATUS,Z; LIMPEA LA BANDERA Z
		    
	             retfie		                  ;fin de la interrupci贸n

MAIN_PROG CODE                      ; let linker place main program              
START
    MOVLW	0x07		;Apagar comparadores
    MOVWF	CMCON
    bsf		STATUS,RP0	          ;Selecciona banco 1
    clrf        TRISB	                  ;Puerto B salidas
    movlw       b'11111111'
    movwf       TRISA                   ;puerto A entradas             
    movlw       b'000000000'             ;Prescaler on, reloj interno, divide por 2(000)4(01)8(010)16(011)64(0101)           
    movwf       OPTION_REG  
    bcf         STATUS,RP0              ;Selecciona banco 0 
    movLW     D'0'
    movwf PAUSE
ESCANEA	              bcf         STATUS,2                ;baja bandera Z de STATUS
                      bcf	  INTCON,7                ;desabilita todas las interrupciones
                      bcf	  INTCON,5                ;desactiva la interrupci贸n por desbordamiento de TMR0
                     btfss       PORTA,0                 ;mira si esta a 1 RA0
	              goto        ESCANEA                 ;no se pulso el bot贸n
	              goto        PLAY                    ;si se pulso el boton

;******
;     Aqui llamo a tabla recorriendola toda, cogiendo datos y comparandolo con FF para saber si llego al final    *
;******

PLAY                  bsf	  INTCON,7                ;habilita todas las interrupciones
                      bsf	  INTCON,5                ;Habilita la interrupci贸n por desbordamiento de TMR0
                      
              
PARTITURA         ; EN ESTA FUNCION VA LA PARTITURA MUSICAL
;--------------------------
		      ;esta partitura inicia en 2 octavos y finaliza en 4 octavos
		      
	 ;;CORO
	CALL MI
	CALL MI
	    
	CALL MI1
	CALL MI1
	CALL MI1
	
	CALL RE1
	CALL DO1
	CALL SI 
	CALL LA
	CALL LA
	
	CALL SILENCIO
	CALL SILENCIO
	
	CALL LA
	CALL DO1
	CALL SI
	CALL LA
	CALL SOL
	CALL LA 
	CALL MI 
	CALL RE
	CALL MI
	CALL MI
	
	CALL SILENCIO	
	CALL SILENCIO
	CALL SILENCIO	
	CALL SILENCIO
	
			;;CORO 2
	CALL MI
	    
	CALL MI1
	CALL MI1
	
	CALL RE1
	CALL DO1
	CALL SI 
	CALL LA
	CALL LA
	
	CALL SILENCIO
	CALL SILENCIO
	
	CALL LA
	CALL DO1
	CALL SI
	CALL LA
	CALL SOL
	CALL LA 
	CALL MI 
	CALL RE
	CALL MI
	CALL MI
	CALL MI	      
		      
	
		
		;;ESTRIBILLO 1
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL FA
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL FA
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL MI1
	CALL MI1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL FA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA     
	CALL DO1
	CALL SI
	CALL SI
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA 
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	;CALL SOL 
	CALL LA
	;CALL LA
	
	;;ESTRIBILLO 2

	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL FA
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL FA
	CALL SILENCIO2
	CALL SILENCIO2
	CALL SILENCIO2
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL MI1
	CALL MI1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL RE1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL FA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA     
	CALL DO1
	CALL SI
	CALL SI
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL RE1
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SI 
	CALL LA
	CALL LA
	
	
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	
		    ;;CORTE
	CALL MI
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL DO
	CALL SI 
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL MI 
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL MI 
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	
	
	
	CALL MI 
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL MI 
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL LA
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SILENCIO
	CALL SOL
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	CALL SILENCIO
	CALL SILENCIO
	CALL DO1
	
	
	
	;ACABA LA CANCION
	
	
	
	;	goto        ESCANEA 
		goto        PARTITURA                   ;cojo otro dato de la tabla
;DE 3 OCTAVA A 5 OCTAVA
DO:		      
	movlw       0x11                    ;DO 
	MOVWF	TONO
	CALL tiempo
	RETURN
RE:
	movlw       0x2B                    ;RE  
	MOVWF	TONO
	CALL tiempo
	RETURN
MI:
	movlw       0x42                    ;MI  
	MOVWF	TONO
	CALL tiempo
	RETURN
FA:
	movlw       0x4D                    ;FA
	MOVWF	TONO
	CALL tiempo
	RETURN
SOL:
	movlw       0x62                    ;SOL
	MOVWF	TONO
	CALL tiempo
	RETURN
LA:
	movlw       0x72                    ;LA  
	MOVWF	TONO
	CALL tiempo
	RETURN
SI:
	movlw       0x81                    ;SI
	MOVWF	TONO
	CALL tiempo
	RETURN
DO1:	
	movlw       0x8A                    ;DO  (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
RE1:
	movlw       0x97                    ;RE  (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
MI1:
	movlw       0Xa3                    ;MI  (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
FA1:
	movlw       0xA8                    ;FA  (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
SOL1:
	movlw       0xB3                    ;SOL (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
LA1:
	movlw       0xBB                    ;LA (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
SI1:
	movlw       0xC2                    ;LA (1 OCTAVA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
DO2:
	movlw      0XC6                    ;DO  (2 OCTAvA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
RE2:
	movlw      0XCd                    ;RE  (2 OCTAvA MAS ALTA)	
	MOVWF	TONO
	CALL tiempo
	RETURN
MI2:
    	movlw      0Xd3                   ;mi  (2 OCTAvA MAS ALTA)
	MOVWF	TONO
	CALL tiempo
	RETURN
tiempo:; ESTA FUNCION CUMPLE LA FUNCION DE DAR EL TIEMPO DECIADO A LA NOTA 
    nop	      ;NOPs de relleno (ajuste de tiempo)
    movlw d'6' ;establecer valor de la variable i
    movwf i
iloop:
    nop	      ;NOPs de relleno (ajuste de tiempo)
    movlw d'50' ;establecer valor de la variable j
    movwf j
jloop:	
    nop
    nop         ;NOPs de relleno (ajuste de tiempo)
    movlw d'61' ;establecer valor de la variable k
    movwf k
kloop:	

    decfsz k,f  
    goto kloop ;[i][j][k]
    decfsz j,f
    goto jloop
    decfsz i,f
    goto iloop
    movlw d'4' ;establecer valor de la variable k
    movwf a
    decfsz a,f  
    goto $-1 
    return	;salir de la rutina de tiempo y regresar al 

    return
SILENCIO:; ESTA FUNCION SIRVE PARA DAR UN SILENCIO LARGO ENTRE NOTAS
    movlw     D'1'                    ;RE  (2 OCTAvA MAS ALTA)	
    MOVWF	PAUSE
    MOVLW d'255' ;MUEVE 255 A W
    MOVWF timer2 ; MUEVE EL VALOR 255 A VARIABLE
    DECFSZ timer2 ;decrementa timer y pregunta hasta 0
    GOTO $-1 ; LOOP DE DECREMENTO
    MOVLW d'255' ;MUEVE 255 A W
    MOVWF timer3 ; MUEVE EL VALOR 255 A VARIABLE
    DECFSZ timer3 ;decrementa timer y pregunta hasta 0
    GOTO $-1 ; LOOP DE DECREMENTO
    MOVLW d'255' ;MUEVE 255 A W
    MOVWF timer4 ; MUEVE EL VALOR 255 A VARIABLE
    DECFSZ timer4 ;decrementa timer y pregunta hasta 0
    GOTO $-1 ; LOOP DE DECREMENTO
    return 
SILENCIO2:; ESTA FUNCION SIRVE PARA DAR UN SILENCIO CORTO ENTRE NOTAS
    movlw     D'1'                    ;RE  (2 OCTAvA MAS ALTA)	
    MOVWF	PAUSE
    MOVLW d'255' ;MUEVE 255 A W
    MOVWF timer5 ; MUEVE EL VALOR 255 A VARIABLE
    DECFSZ timer5 ;decrementa timer y pregunta hasta 0
    GOTO $-1 ; LOOP DE DECREMENTO
    return 
    END
